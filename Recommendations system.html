‎'use client'
‎import { useState } from 'react'
‎
‎export default function RecommendationSystem({ recommendations, setRecommendations, isAdmin, shop }) {
‎  const [newRecommendation, setNewRecommendation] = useState({
‎    recommendation: '',
‎    file: null
‎  })
‎  const [adminNotes, setAdminNotes] = useState('')
‎  const [error, setError] = useState('')
‎  const [success, setSuccess] = useState('')
‎
‎  const handleInputChange = (e) => {
‎    const { name, value } = e.target
‎    setNewRecommendation(prev => ({ ...prev, [name]: value }))
‎  }
‎
‎  const handleFileChange = (e) => {
‎    setNewRecommendation(prev => ({ ...prev, file: e.target.files[0] }))
‎  }
‎
‎  const handleSubmit = () => {
‎    setError('')
‎    setSuccess('')
‎    
‎    if (!newRecommendation.recommendation) {
‎      setError('Recommendation text is required')
‎      return
‎    }
‎
‎    const currentUser = JSON.parse(localStorage.getItem('currentUser'))
‎    const recommendation = {
‎      id: Date.now(),
‎      recommendation: newRecommendation.recommendation,
‎      status: 'pending',
‎      adminNotes: '',
‎      createdAt: new Date().toISOString(),
‎      submittedBy: currentUser.name,
‎      shop: isAdmin ? null : shop
‎    }
‎
‎    const updatedRecommendations = [...recommendations, recommendation]
‎    setRecommendations(updatedRecommendations)
‎    localStorage.setItem('recommendations', JSON.stringify(updatedRecommendations))
‎    
‎    setSuccess('Recommendation submitted successfully!')
‎    setNewRecommendation({
‎      recommendation: '',
‎      file: null
‎    })
‎  }
‎
‎  const handleUpdateStatus = (recommendationId, status) => {
‎    const updatedRecommendations = recommendations.map(rec => 
‎      rec.id === recommendationId 
‎        ? { 
‎            ...rec, 
‎            status,
‎            adminNotes: status === 'rejected' ? adminNotes : rec.adminNotes
‎          } 
‎        : rec
‎    )
‎    setRecommendations(updatedRecommendations)
‎    localStorage.setItem('recommendations', JSON.stringify(updatedRecommendations))
‎    setAdminNotes('')
‎  }
‎
‎  const filteredRecommendations = isAdmin 
‎    ? recommendations 
‎    : recommendations.filter(rec => rec.shop === shop)
‎
‎  return (
‎    <div className="bg-white p-4 rounded-lg shadow">
‎      <h2 className="text-xl font-semibold mb-4">
‎        {isAdmin ? 'Employee Recommendations' : 'Submit Recommendation'}
‎      </h2>
‎      
‎      {!isAdmin && (
‎        <div className="mb-6 p-4 border rounded">
‎          <h3 className="font-medium mb-3">New Recommendation</h3>
‎          {error && <p className="text-red-500 mb-2">{error}</p>}
‎          {success && <p className="text-green-500 mb-2">{success}</p>}
‎          
‎          <div className="space-y-3">
‎            <div>
‎              <label className="block text-sm font-medium mb-1">Your Recommendation</label>
‎              <textarea
‎                name="recommendation"
‎                value={newRecommendation.recommendation}
‎                onChange={handleInputChange}
‎                className="w-full px-3 py-2 border rounded"
‎                rows="4"
‎                placeholder="How can we improve the business?"
‎                required
‎              />
‎            </div>
‎            
‎            <div>
‎              <label className="block text-sm font-medium mb-1">Attachment (Optional)</label>
‎              <input
‎                type="file"
‎                onChange={handleFileChange}
‎                className="w-full px-3 py-2 border rounded"
‎              />
‎            </div>
‎            
‎            <button
‎              onClick={handleSubmit}
‎              className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
‎            >
‎              Submit Recommendation
‎            </button>
‎          </div>
‎        </div>
‎      )}
‎      
‎      <div>
‎        <h3 className="font-medium mb-2">
‎          {isAdmin ? 'All Recommendations' : 'Your Recommendations'}
‎        </h3>
‎        
‎        {filteredRecommendations.length === 0 ? (
‎          <p className="text-gray-500">No recommendations found</p>
‎        ) : (
‎          <div className="space-y-4">
‎            {filteredRecommendations.map(recommendation => (
‎              <div key={recommendation.id} className="border rounded-lg p-4">
‎                <div className="flex justify-between items-start">
‎                  <div>
‎                    <p className="font-medium">{recommendation.recommendation}</p>
‎                    <p className="text-sm text-gray-500 mt-1">
‎                      Submitted by {recommendation.submittedBy} on {new Date(recommendation.createdAt).toLocaleString()}
‎                    </p>
‎                    {recommendation.shop && (
‎                      <p className="text-sm text-gray-500">
‎                        Shop: {recommendation.shop === 'boutique' ? 'Boutique' : 'House Decoration'}
‎                      </p>
‎                    )}
‎                  </div>
‎                  <span className={`px-2 py-1 rounded-full text-xs ${
‎                    recommendation.status === 'approved' ? 'bg-green-100 text-green-800' :
‎                    recommendation.status === 'rejected' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
‎                  }`}>
‎                    {recommendation.status}
‎                  </span>
‎                </div>
‎                
‎                {recommendation.adminNotes && (
‎                  <div className="mt-2 p-2 bg-gray-50 rounded">
‎                    <p className="text-sm font-medium">Admin Response:</p>
‎                    <p className="text-sm">{recommendation.adminNotes}</p>
‎                  </div>
‎                )}
‎                
‎                {isAdmin && recommendation.status === 'pending' && (
‎                  <div className="mt-3 pt-3 border-t">
‎                    <textarea
‎                      value={adminNotes}
‎                      onChange={(e) => setAdminNotes(e.target.value)}
‎                      className="w-full px-3 py-2 border rounded mb-2"
‎                      placeholder="Add notes (required for rejection)"
‎                      rows="2"
‎                    />
‎                    <div className="flex space-x-2">
‎                      <button
‎                        onClick={() => handleUpdateStatus(recommendation.id, 'approved')}
‎                        className="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700"
‎                      >
‎                        Approve
‎                      </button>
‎                      <button
‎                        onClick={() => handleUpdateStatus(recommendation.id, 'rejected')}
‎                        disabled={!adminNotes}
‎                        className={`px-3 py-1 rounded ${
‎                          adminNotes ? 'bg-red-600 text-white hover:bg-red-700' : 'bg-gray-200 text-gray-500'
‎                        }`}
‎                      >
‎                        Reject
‎                      </button>
‎                    </div>
‎                  </div>
‎                )}
‎              </div>
‎            ))}
‎          </div>
‎        )}
‎      </div>
‎    </div>
‎  )
‎}
‎
