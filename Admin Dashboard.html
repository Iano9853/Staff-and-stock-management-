‎'use client'
‎import { useEffect, useState } from 'react'
‎import { useRouter } from 'next/navigation'
‎import UserVerification from '@/components/UserVerification'
‎import StockManagement from '@/components/StockManagement'
‎import AIAssistant from '@/components/AIAssistant'
‎import DataExport from '@/components/DataExport'
‎import RequestSystem from '@/components/RequestSystem'
‎import RecommendationSystem from '@/components/RecommendationSystem'
‎
‎export default function AdminDashboard() {
‎  const [currentTab, setCurrentTab] = useState('dashboard')
‎  const [users, setUsers] = useState([])
‎  const [stock, setStock] = useState({ boutique: [], decoration: [] })
‎  const [requests, setRequests] = useState([])
‎  const [recommendations, setRecommendations] = useState([])
‎  const [stats, setStats] = useState({
‎    totalEmployees: 0,
‎    verifiedEmployees: 0,
‎    boutiqueStock: 0,
‎    decorationStock: 0,
‎    pendingRequests: 0
‎  })
‎  const router = useRouter()
‎
‎  useEffect(() => {
‎    // Check authentication
‎    const currentUser = JSON.parse(localStorage.getItem('currentUser'))
‎    if (!currentUser || currentUser.role !== 'admin') {
‎      router.push('/login')
‎      return
‎    }
‎
‎    loadData()
‎  }, [])
‎
‎  const loadData = () => {
‎    const loadedUsers = JSON.parse(localStorage.getItem('users')) || []
‎    const loadedStock = JSON.parse(localStorage.getItem('stock')) || { boutique: [], decoration: [] }
‎    const loadedRequests = JSON.parse(localStorage.getItem('requests')) || []
‎    const loadedRecommendations = JSON.parse(localStorage.getItem('recommendations')) || []
‎    
‎    setUsers(loadedUsers)
‎    setStock(loadedStock)
‎    setRequests(loadedRequests)
‎    setRecommendations(loadedRecommendations)
‎
‎    // Calculate stats
‎    setStats({
‎      totalEmployees: loadedUsers.filter(u => u.role === 'employee').length,
‎      verifiedEmployees: loadedUsers.filter(u => u.role === 'employee' && u.verified).length,
‎      boutiqueStock: loadedStock.boutique.reduce((sum, item) => sum + item.quantity, 0),
‎      decorationStock: loadedStock.decoration.reduce((sum, item) => sum + item.quantity, 0),
‎      pendingRequests: loadedRequests.filter(r => !r.resolved).length
‎    })
‎  }
‎
‎  const verifyUser = (userId) => {
‎    const updatedUsers = users.map(user => 
‎      user.id === userId ? { ...user, verified: true } : user
‎    )
‎    setUsers(updatedUsers)
‎    localStorage.setItem('users', JSON.stringify(updatedUsers))
‎    loadData() // Refresh data
‎  }
‎
‎  const deleteUser = (userId) => {
‎    if (window.confirm('Are you sure you want to delete this user?')) {
‎      const updatedUsers = users.filter(user => user.id !== userId)
‎      setUsers(updatedUsers)
‎      localStorage.setItem('users', JSON.stringify(updatedUsers))
‎      loadData() // Refresh data
‎    }
‎  }
‎
‎  const handleLogout = () => {
‎    localStorage.removeItem('currentUser')
‎    router.push('/login')
‎  }
‎
‎  return (
‎    <div className="container mx-auto p-4">
‎      <div className="flex justify-between items-center mb-6">
‎        <h1 className="text-2xl font-bold">Admin Dashboard</h1>
‎        <button 
‎          onClick={handleLogout}
‎          className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
‎        >
‎          Logout
‎        </button>
‎      </div>
‎      
‎      {/* Navigation Tabs */}
‎      <div className="flex space-x-2 mb-6 overflow-x-auto">
‎        <button 
‎          onClick={() => setCurrentTab('dashboard')} 
‎          className={`px-4 py-2 rounded ${currentTab === 'dashboard' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}
‎        >
‎          Overview
‎        </button>
‎        <button 
‎          onClick={() => setCurrentTab('users')} 
‎          className={`px-4 py-2 rounded ${currentTab === 'users' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}
‎        >
‎          User Management
‎        </button>
‎        <button 
‎          onClick={() => setCurrentTab('stock')} 
‎          className={`px-4 py-2 rounded ${currentTab === 'stock' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}
‎        >
‎          Stock Management
‎        </button>
‎        <button 
‎          onClick={() => setCurrentTab('requests')} 
‎          className={`px-4 py-2 rounded ${currentTab === 'requests' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}
‎        >
‎          Customer Requests ({stats.pendingRequests})
‎        </button>
‎        <button 
‎          onClick={() => setCurrentTab('recommendations')} 
‎          className={`px-4 py-2 rounded ${currentTab === 'recommendations' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}
‎        >
‎          Recommendations
‎        </button>
‎        <button 
‎          onClick={() => setCurrentTab('export')} 
‎          className={`px-4 py-2 rounded ${currentTab === 'export' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}
‎        >
‎          Data Export
‎        </button>
‎      </div>
‎
‎      {/* Dashboard Overview */}
‎      {currentTab === 'dashboard' && (
‎        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
‎          <div className="bg-white p-4 rounded-lg shadow">
‎            <h3 className="font-medium text-gray-500">Total Employees</h3>
‎            <p className="text-3xl font-bold">{stats.totalEmployees}</p>
‎          </div>
‎          <div className="bg-white p-4 rounded-lg shadow">
‎            <h3 className="font-medium text-gray-500">Verified Employees</h3>
‎            <p className="text-3xl font-bold">{stats.verifiedEmployees}</p>
‎          </div>
‎          <div className="bg-white p-4 rounded-lg shadow">
‎            <h3 className="font-medium text-gray-500">Boutique Stock</h3>
‎            <p className="text-3xl font-bold">{stats.boutiqueStock} items</p>
‎          </div>
‎          <div className="bg-white p-4 rounded-lg shadow">
‎            <h3 className="font-medium text-gray-500">Decoration Stock</h3>
‎            <p className="text-3xl font-bold">{stats.decorationStock} items</p>
‎          </div>
‎        </div>
‎      )}
‎
‎      {/* User Management */}
‎      {currentTab === 'users' && (
‎        <UserVerification 
‎          users={users} 
‎          onVerify={verifyUser} 
‎          onDelete={deleteUser} 
‎        />
‎      )}
‎
‎      {/* Stock Management */}
‎      {currentTab === 'stock' && (
‎        <StockManagement stock={stock} setStock={setStock} onUpdate={loadData} />
‎      )}
‎
‎      {/* Customer Requests */}
‎      {currentTab === 'requests' && (
‎        <RequestSystem 
‎          requests={requests} 
‎          setRequests={setRequests} 
‎          isAdmin={true} 
‎        />
‎      )}
‎
‎      {/* Recommendations */}
‎      {currentTab === 'recommendations' && (
‎        <RecommendationSystem 
‎          recommendations={recommendations} 
‎          setRecommendations={setRecommendations} 
‎          isAdmin={true} 
‎        />
‎      )}
‎
‎      {/* Data Export */}
‎      {currentTab === 'export' && (
‎        <DataExport 
‎          users={users} 
‎          stock={stock} 
‎          requests={requests} 
‎          recommendations={recommendations} 
‎        />
‎      )}
‎      
‎      <AIAssistant role="admin" onAction={loadData} />
‎    </div>
‎  )
‎}
‎
